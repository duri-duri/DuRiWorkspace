name: lint (PR changed files)

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]

permissions:
  contents: read

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout (full history for diff)
        uses: actions/checkout@v4
        with: { fetch-depth: 0 }

      - name: Setup Python
        uses: actions/setup-python@v5
        with: { python-version: "3.10" }

      - name: Install pre-commit
        run: pip install pre-commit

      - name: Run pre-commit on changed files
        env:
          BASE: ${{ github.event.pull_request.base.sha }}
          HEAD: ${{ github.event.pull_request.head.sha }}
        run: |
          pre-commit install
          # 린트 가능한 확장자만 추출
          CHANGED=$(git diff --name-only "$BASE" "$HEAD" -- \
            '*.py' '*.json' '*.yml' '*.yaml' | tr '\n' ' ')
          if [ -z "$CHANGED" ]; then
            echo "No changed lintable files."
            exit 0
          fi
          echo "Changed files: $CHANGED"
          # 파일 수정이 발생하면 exit 1로 실패 → 수정사항 커밋 필요
          pre-commit run --files $CHANGED --color always --show-diff-on-failure
