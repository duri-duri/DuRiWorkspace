name: required-checks-alias
on:
  pull_request:
    branches: [ main ]

jobs:
  phase2-test:
    name: phase-2 Suites / test   # ← 규칙이 기대하는 이름과 정확히 일치
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - name: Install deps
        run: |
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
      - name: Run objective gate path
        run: |
          make rollup || true
          make day50 || true
          make gate-objective

  repo-guard:
    name: repo-guard               # ← 규칙이 기대하는 이름과 정확히 일치
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Block VCS artifacts (light)
        run: |
          ! git ls-files | grep -E '(^|/)outputs/|(^|/)slo_sla_dashboard_v1/metrics.json' \
            || (echo "Artifacts present in VCS"; exit 1)
      - name: YAML sanity (configs)
        run: |
          python - <<'PY'
import glob, yaml, sys, pathlib
files = []
files += glob.glob('configs/**/*.yaml', recursive=True)
if pathlib.Path('configs/canary_settings.yaml').exists():
    files.append('configs/canary_settings.yaml')
for f in files:
    with open(f, 'r', encoding='utf-8') as fh:
        yaml.safe_load(fh)
print("YAML OK:", len(files), "files")
PY
