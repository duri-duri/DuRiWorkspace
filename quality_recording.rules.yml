groups:
- name: quality-recordings
  interval: 1m
  rules:
  # nDCG
  - record: duri_ndcg_ma7
    expr: avg_over_time(duri_ndcg_at_k{k="3",scope="all",domain="ALL"}[7d])
  - record: duri_ndcg_std7
    expr: stddev_over_time(duri_ndcg_at_k{k="3",scope="all",domain="ALL"}[7d])
  - record: duri_ndcg_wow
    expr: duri_ndcg_at_k{k="3",scope="all",domain="ALL"} - duri_ndcg_at_k{k="3",scope="all",domain="ALL"} offset 7d
  - record: duri_ndcg_wow_pct
    expr: clamp_min(
      (duri_ndcg_at_k{k="3",scope="all",domain="ALL"} - duri_ndcg_at_k{k="3",scope="all",domain="ALL"} offset 7d)
      / duri_ndcg_at_k{k="3",scope="all",domain="ALL"} offset 7d, -1e9)
  - record: duri_ndcg_z
    expr: (duri_ndcg_at_k{k="3",scope="all",domain="ALL"} - duri_ndcg_ma7) / clamp_min(duri_ndcg_std7, 1e-6)

  # MRR (이름 정합성: at_k 계열로 통일)
  - record: duri_mrr_ma7
    expr: avg_over_time(duri_mrr_at_k{k="3",scope="all",domain="ALL"}[7d])
  - record: duri_mrr_std7
    expr: stddev_over_time(duri_mrr_at_k{k="3",scope="all",domain="ALL"}[7d])
  - record: duri_mrr_wow
    expr: duri_mrr_at_k{k="3",scope="all",domain="ALL"} - duri_mrr_at_k{k="3",scope="all",domain="ALL"} offset 7d
  - record: duri_mrr_wow_pct
    expr: clamp_min(
      (duri_mrr_at_k{k="3",scope="all",domain="ALL"} - duri_mrr_at_k{k="3",scope="all",domain="ALL"} offset 7d)
      / duri_mrr_at_k{k="3",scope="all",domain="ALL"} offset 7d, -1e9)
  - record: duri_mrr_z
    expr: (duri_mrr_at_k{k="3",scope="all",domain="ALL"} - duri_mrr_ma7) / clamp_min(duri_mrr_std7, 1e-6)
