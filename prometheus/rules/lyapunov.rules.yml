# Lyapunov Control Function Rules
# Purpose: Calculate control function V(t) and trigger corrective actions

groups:
  - name: lyapunov
    interval: 1m
    rules:
      # Recording rule: Lyapunov control function V(t)
      - record: duri_lyapunov_v
        expr: |
          alpha_const * (1 - duri_green_uptime_ratio) * (1 - duri_green_uptime_ratio)
          + beta_const * duri_alert_rate_per_hour / 10
          + gamma_const * duri_mttr_seconds / 600
          + delta_const * (1 - duri_dr_success_ratio_7d)
          + epsilon_const * clamp_min(ev_target - rate(duri_ev_created_total[1h]), 0)
      
      # Recording rule: Lyapunov delta (change rate)
      - record: duri_lyapunov_delta
        expr: |
          duri_lyapunov_v - (duri_lyapunov_v offset 5m)
      
      # Alert: Lyapunov V increasing (system instability)
      - alert: LyapunovVIncreasing
        expr: |
          duri_lyapunov_delta > 0
        for: 5m
        labels: { severity: warning, team: "ops", component: "control" }
        annotations:
          summary: "System control function V(t) increasing"
          description: "Î”V={{ $value }} > 0. Trigger corrective actions: throttle merges, increase retries, strengthen canary."

