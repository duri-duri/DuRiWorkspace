groups:
- name: duri-target
  interval: 30s
  rules:
  # 2.1) 1차 목표함수 승격: success_rate 및 latency_p50
  # Success/Fail 카운터가 duri_req_total{arm, status="success|fail"}로 노출된다고 가정
  - record: ab:success_rate_5m
    expr: |
      sum by (arm) (rate(duri_req_total{status="success"}[5m])) 
      / sum by (arm) (rate(duri_req_total[5m]))
  
  - record: ab:latency_p50_5m
    expr: |
      histogram_quantile(0.50, sum by (arm, le) (rate(duri_req_latency_seconds_bucket[5m])))
  
  # 권고: success_rate를 1차 목표로 사용 (의미해석 명확 + 노이즈 낮음)
  - alert: ABSuccessRateDrift
    expr: |
      (
        ab:success_rate_5m{arm="A"} - ab:success_rate_5m{arm="B"}
      ) < -0.02
    for: 10m
    labels: {severity: info}
    annotations:
      summary: "Success rate drift detected (A vs B)"
      description: "A가 B보다 성공률이 2%p 이상 낮음: {{ $value }}"

