# 크론 스케줄링 시스템 축 (Cron Scheduling System Axis)

## 🎯 축 개요

**크론 스케줄링 시스템 축**은 자동화된 백업 및 시스템 작업의 스케줄링 및 실행을 관리하는 핵심 축입니다. 이 축은 정기적인 백업 작업, 의존성 기반 작업 순서 관리, 스케줄 충돌 방지, 그리고 시스템 자동화를 체계적으로 관리합니다.

---

## 📊 축의 중요성

### 🔍 **왜 이 축이 중요한가?**

1. **자동화 기반**: 모든 백업 및 시스템 작업의 자동화된 실행
2. **의존성 관리**: 작업 간의 의존성을 고려한 순차적 실행
3. **충돌 방지**: 스케줄 충돌을 방지하고 최적화
4. **모니터링**: 작업 실행 상태를 실시간으로 모니터링
5. **장애 복구**: 실패 시 자동 재시도 및 알림 시스템
6. **운영 최적화**: 운영시간을 고려한 스케줄 조정

---

## 🔧 축의 구성 요소

### 1. 정기 백업 스케줄 관리
- **위치**: `configs/standard_crontab.txt`, `crontab_final.txt`
- **기능**:
  - **일일 백업**: 평일 18:00 INCR → 18:20 FULL → 18:50 Health
  - **주간 백업**: 일요일 15:00 FULL 백업
  - **아침 점검**: 매일 08:55 자동 점검/보정
  - **스모크 테스트**: 매일 09:00 복구 테스트
  - **HDD 정리**: 평일 11:30 COMMIT, 18:10 PURGE
  - **축 관리**: 평일 18:20 분류, 18:25 대시보드 집계

### 2. 의존성 기반 작업 순서 관리
- **위치**: `configs/standard_schedule.yml`
- **기능**:
  - **의존성 규칙**: INCR → RETENTION → HEALTH → SUMMARY 순서
  - **스킵 조건**: 변경된 파일 없음, 게이트 FULL 성공 시 스킵
  - **최대 실행 시간**: 각 작업별 최대 실행 시간 설정
  - **실패 처리**: INCR 실패 시 RETENTION 1일 연기

### 3. 스케줄 충돌 방지 및 최적화
- **기능**:
  - **flock 락 메커니즘**: 동일 작업의 중복 실행 방지
  - **운영시간 고려**: 평일 09-19, 일요일 09-16 운영시간 내 스케줄
  - **점심시간 배제**: 13:00-14:00 업무 중단 시간 고려
  - **업무 종료 전**: 평일 18:00-19:00, 일요일 15:00-16:00 백업 시간

### 4. 작업 실행 상태 모니터링
- **기능**:
  - **로그 기반 모니터링**: 각 작업별 전용 로그 파일
  - **실행 상태 추적**: 성공/실패 상태 실시간 추적
  - **성능 모니터링**: 실행 시간 및 리소스 사용량 모니터링
  - **알림 시스템**: 실패 시 자동 알림 (`ops_alert.sh`)

### 5. 실패 시 자동 재시도 및 알림
- **기능**:
  - **자동 재시도**: 실패한 작업의 자동 재시도 메커니즘
  - **알림 시스템**: 실패 시 즉시 알림 발송
  - **복구 프로세스**: 아침 자동 점검/보정으로 시스템 복구
  - **상태 보고**: 일일/주간 상태 보고서 자동 생성

### 6. 운영시간 기반 스케줄 조정
- **기능**:
  - **운영시간 설정**: 평일 09-19, 토요일 OFF, 일요일 09-16
  - **휴일 처리**: `etc/holidays.txt` 기반 휴일 스케줄 조정
  - **업무 시간 최적화**: 업무 종료 1시간 전 백업 실행
  - **주말 정리**: 토요일 정리 작업, 일요일 검증 루틴

### 7. 아침 자동 점검/보정 시스템
- **위치**: `scripts/morning_check_and_recover.sh`
- **기능**:
  - **시스템 상태 점검**: 매일 아침 시스템 상태 자동 점검
  - **자동 보정**: 발견된 문제 자동 보정
  - **복구 테스트**: 스모크 복구 테스트 자동 실행
  - **상태 보고**: 점검 결과 자동 보고

### 8. 스모크 복구 테스트 자동화
- **위치**: `scripts/smoke_restore_test.sh`
- **기능**:
  - **자동 테스트**: 매일 아침 최신 백업으로 복구 테스트
  - **빠른 테스트**: `--fast` 옵션으로 빠른 테스트 실행
  - **기록 관리**: 테스트 결과 자동 기록
  - **실패 알림**: 테스트 실패 시 즉시 알림

### 9. HDD 정리 및 축 관리 시스템
- **위치**: `tools/cron_snapshots.sh`, `tools/cleanup_space.sh`
- **기능**:
  - **상태 스냅샷**: 평일 09:02 상태 스냅샷 생성
  - **공간 정리**: 평일 11:30 COMMIT, 18:10 PURGE
  - **축 분류**: 평일 18:20 축별 분류 작업
  - **대시보드 집계**: 평일 18:25 대시보드 데이터 집계

---

## 📁 디렉토리 구조

```
backup_repository/backup_axes_management/cron_scheduling_system/
├── schedule_management/     # 스케줄 관리
│   ├── crontab_configs/     # 크론탭 설정 파일
│   ├── schedule_policies/   # 스케줄 정책
│   ├── time_optimization/  # 시간 최적화
│   └── schedule_templates/  # 스케줄 템플릿
├── dependency_management/   # 의존성 관리
│   ├── dependency_rules/    # 의존성 규칙
│   ├── execution_order/    # 실행 순서
│   ├── skip_conditions/    # 스킵 조건
│   └── failure_handling/   # 실패 처리
├── execution_monitoring/   # 실행 모니터링
│   ├── log_analysis/       # 로그 분석
│   ├── status_tracking/    # 상태 추적
│   ├── performance_metrics/ # 성능 지표
│   └── alert_system/       # 알림 시스템
├── conflict_resolution/     # 충돌 해결
│   ├── lock_mechanisms/    # 락 메커니즘
│   ├── resource_conflicts/ # 리소스 충돌
│   ├── schedule_conflicts/ # 스케줄 충돌
│   └── conflict_prevention/ # 충돌 예방
├── retry_mechanisms/       # 재시도 메커니즘
│   ├── retry_policies/     # 재시도 정책
│   ├── backoff_strategies/ # 백오프 전략
│   ├── failure_recovery/   # 실패 복구
│   └── retry_monitoring/   # 재시도 모니터링
├── schedule_optimization/  # 스케줄 최적화
│   ├── load_balancing/     # 로드 밸런싱
│   ├── resource_optimization/ # 리소스 최적화
│   ├── time_slot_optimization/ # 시간 슬롯 최적화
│   └── efficiency_analysis/ # 효율성 분석
└── operational_schedules/   # 운영 스케줄
    ├── daily_schedules/    # 일일 스케줄
    ├── weekly_schedules/   # 주간 스케줄
    ├── monthly_schedules/  # 월간 스케줄
    ├── holiday_schedules/ # 휴일 스케줄
    └── emergency_schedules/ # 비상 스케줄
```

---

## 🔄 크론 스케줄링 관리 프로세스

### 1. 일일 스케줄 실행 프로세스
```bash
# 아침 점검 (08:55)
55 8 * * * morning_check_and_recover.sh

# 스모크 테스트 (09:00)
0 9 * * * smoke_restore_test.sh --fast --record

# HDD 정리 (11:30)
30 11 * * 1-5 cleanup_space.sh --commit --days-keep=5

# 백업 실행 (18:00-18:50)
0 18 * * 1-5 duri_backup_phase1.sh incr
20 18 * * 1-5 duri_backup_phase1.sh full
50 18 * * 1-5 run_health_and_mark.sh

# 축 관리 (18:20-18:25)
20 18 * * 1-5 classify_axes.sh
25 18 * * 1-5 axis_dashboard.sh
```

### 2. 주간 스케줄 실행 프로세스
```bash
# 주간 FULL 백업 (일요일 15:00)
0 15 * * 0 duri_backup_phase1.sh full

# 주간 검증 루틴 (일요일 15:00-16:00)
# 업무 종료 전 검증 작업들
```

### 3. 의존성 관리 프로세스
```yaml
# standard_schedule.yml 기반
dependencies:
  INCR:
    - time: "18:30"
      max_duration: "20분"
      skip_conditions:
        - "변경된 파일 없음"
        - "게이트 FULL 성공 (동일 날짜)"
  
  RETENTION:
    - time: "18:45"
      dependencies: ["INCR"]
      skip_conditions:
        - "INCR 실패 시 1일 연기"
        - "정리 대상 파일 없음"
```

### 4. 충돌 방지 프로세스
```bash
# flock 락을 사용한 중복 실행 방지
flock -n var/locks/incr.lock -c 'duri_backup_phase1.sh incr'
flock -n var/locks/full.lock -c 'duri_backup_phase1.sh full'
flock -n var/locks/health.lock -c 'run_health_and_mark.sh'
```

---

## 📈 성능 지표

### 주요 메트릭
1. **스케줄 실행 성공률**: 스케줄된 작업의 성공 실행 비율
2. **충돌 발생률**: 스케줄 충돌 발생 비율
3. **스케줄 최적화 효율**: 스케줄 최적화의 효율성
4. **의존성 준수율**: 의존성 규칙 준수 비율
5. **재시도 성공률**: 실패 후 재시도 성공 비율
6. **운영시간 준수율**: 운영시간 내 스케줄 실행 비율

### 임계값 설정
- **스케줄 실행 성공률**: ≥ 95%
- **충돌 발생률**: ≤ 2%
- **스케줄 최적화 효율**: ≥ 85%
- **의존성 준수율**: ≥ 98%
- **재시도 성공률**: ≥ 80%
- **운영시간 준수율**: ≥ 99%

---

## 🚨 알림 시스템

### 알림 조건
1. **스케줄 실행 실패**: 스케줄된 작업 실행 실패 시 알림
2. **충돌 발생**: 스케줄 충돌 발생 시 알림
3. **의존성 위반**: 의존성 규칙 위반 시 알림
4. **재시도 실패**: 재시도 후에도 실패 시 알림
5. **운영시간 초과**: 운영시간 외 실행 시 알림
6. **리소스 부족**: 리소스 부족으로 인한 실행 실패 시 알림

### 알림 방법
- **실시간 대시보드**: 스케줄 실행 상태 실시간 표시
- **일일 리포트**: 스케줄 실행 결과 일일 리포트
- **주간 분석**: 스케줄 최적화 및 개선 제안
- **월간 리포트**: 전체 크론 스케줄링 시스템 성과 분석

---

## 🔧 관리 정책

### 백업 주기
- **스케줄 변경 시**: 스케줄이 변경될 때마다 즉시 백업
- **의존성 업데이트 시**: 의존성 규칙이 업데이트될 때마다 백업
- **주간 백업**: 매주 정기 백업
- **월간 백업**: 매월 전체 스케줄 설정 백업

### 보관 기간
- **스케줄 설정**: 2년간 보관
- **실행 로그**: 1년간 보관
- **의존성 규칙**: 2년간 보관
- **충돌 해결 기록**: 6개월간 보관
- **최적화 결과**: 1년간 보관

### 검증 방법
- **스케줄 실행 성공률**: 스케줄된 작업의 성공 실행 비율 확인
- **충돌 검사**: 스케줄 충돌 발생 여부 확인
- **의존성 준수**: 의존성 규칙 준수 여부 확인
- **운영시간 준수**: 운영시간 내 실행 여부 확인

---

## 🚀 발전 방향

### 단기 목표 (1-3개월)
- [ ] 스케줄 실행 성공률 모니터링 시스템 구축
- [ ] 의존성 관리 자동화 시스템
- [ ] 충돌 방지 시스템 고도화
- [ ] 스케줄 최적화 자동화

### 중기 목표 (3-6개월)
- [ ] 지능형 스케줄링 시스템
- [ ] 예측적 충돌 방지 시스템
- [ ] 자동 스케줄 최적화 시스템
- [ ] 실시간 스케줄 모니터링 플랫폼

### 장기 목표 (6-12개월)
- [ ] AI 기반 스케줄 예측 시스템
- [ ] 자동화된 스케줄 최적화 시스템
- [ ] 지능형 충돌 방지 시스템
- [ ] 예측적 스케줄 관리 시스템

---

## 📋 체크리스트

### 스케줄 관리
- [ ] 정기 백업 스케줄 설정
- [ ] 운영시간 기반 스케줄 조정
- [ ] 휴일 스케줄 처리
- [ ] 스케줄 템플릿 관리

### 의존성 관리
- [ ] 작업 간 의존성 규칙 정의
- [ ] 실행 순서 최적화
- [ ] 스킵 조건 설정
- [ ] 실패 처리 정책

### 실행 모니터링
- [ ] 로그 분석 시스템
- [ ] 상태 추적 시스템
- [ ] 성능 지표 모니터링
- [ ] 알림 시스템 구축

### 충돌 해결
- [ ] 락 메커니즘 구현
- [ ] 리소스 충돌 방지
- [ ] 스케줄 충돌 방지
- [ ] 충돌 예방 시스템

### 재시도 메커니즘
- [ ] 재시도 정책 설정
- [ ] 백오프 전략 구현
- [ ] 실패 복구 시스템
- [ ] 재시도 모니터링

### 스케줄 최적화
- [ ] 로드 밸런싱
- [ ] 리소스 최적화
- [ ] 시간 슬롯 최적화
- [ ] 효율성 분석

### 운영 스케줄
- [ ] 일일 스케줄 관리
- [ ] 주간 스케줄 관리
- [ ] 월간 스케줄 관리
- [ ] 휴일 스케줄 관리
- [ ] 비상 스케줄 관리

---

## 🎯 결론

**크론 스케줄링 시스템 축**은 자동화된 백업 및 시스템 작업의 스케줄링 및 실행을 관리하는 핵심 축입니다. 이 축을 통해 정기적인 백업 작업, 의존성 기반 작업 순서 관리, 스케줄 충돌 방지, 그리고 시스템 자동화를 체계적으로 관리할 수 있습니다.

지속적인 발전을 통해 더욱 정교하고 자동화된 스케줄링 관리 시스템을 구축할 수 있습니다.

---

**문서 생성일**: 2025-01-27  
**문서 버전**: 1.0  
**관리자**: DuRi 시스템  
**상태**: ✅ 활성

