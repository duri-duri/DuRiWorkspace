<!DOCTYPE html>
<html>
<head>
    <title>DuRi ë¶„ì‚° ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§</title>
    <meta charset="utf-8">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .node-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .node-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .node-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-healthy {
            background-color: #4CAF50;
        }
        .status-unhealthy {
            background-color: #f44336;
        }
        .status-warning {
            background-color: #ff9800;
        }
        .metrics {
            margin-top: 15px;
        }
        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        .metric-label {
            font-weight: bold;
            color: #666;
        }
        .metric-value {
            color: #333;
        }
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .refresh-btn:hover {
            background: #5a6fd8;
        }
        .log-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 400px;
            overflow-y: auto;
        }
        .automation-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .automation-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .control-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
        }
        .control-btn.stop {
            background: #f44336;
        }
        .control-btn:hover {
            opacity: 0.8;
        }
        .log-entry {
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        .log-info {
            background-color: #e3f2fd;
            border-left: 4px solid #2196F3;
        }
        .log-success {
            background-color: #e8f5e8;
            border-left: 4px solid #4CAF50;
        }
        .log-error {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§  DuRi ë¶„ì‚° ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§</h1>
            <p>3ê³„ì¸µ ë¶„ì‚° êµ¬ì¡° ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</p>
            <p>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="last-update">-</span></p>
        </div>

        <button class="refresh-btn" onclick="refreshData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>

        <div class="node-grid">
            <div class="node-card">
                <div class="node-title">ğŸŒ Core Node (í¬íŠ¸ 8090)</div>
                <div>
                    <span class="status-indicator" id="core-status"></span>
                    <span id="core-status-text">í™•ì¸ ì¤‘...</span>
                </div>
                <div class="metrics">
                    <div class="metric">
                        <span class="metric-label">ì—­í• :</span>
                        <span class="metric-value">API Gateway</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ìš”ì²­ ì²˜ë¦¬:</span>
                        <span class="metric-value" id="core-requests">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ì‘ë‹µ ì‹œê°„:</span>
                        <span class="metric-value" id="core-response-time">-</span>
                    </div>
                </div>
            </div>

            <div class="node-card">
                <div class="node-title">ğŸ§  Brain Node (í¬íŠ¸ 8091)</div>
                <div>
                    <span class="status-indicator" id="brain-status"></span>
                    <span id="brain-status-text">í™•ì¸ ì¤‘...</span>
                </div>
                <div class="metrics">
                    <div class="metric">
                        <span class="metric-label">ì—­í• :</span>
                        <span class="metric-value">íŒë‹¨/ê¸°ì–µ/ì² í•™</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ë¶„ì„ ì ìˆ˜:</span>
                        <span class="metric-value" id="brain-score">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ì²˜ë¦¬ ì‹œê°„:</span>
                        <span class="metric-value" id="brain-processing-time">-</span>
                    </div>
                </div>
            </div>

            <div class="node-card">
                <div class="node-title">ğŸ”„ Evolution Node (í¬íŠ¸ 8092)</div>
                <div>
                    <span class="status-indicator" id="evolution-status"></span>
                    <span id="evolution-status-text">í™•ì¸ ì¤‘...</span>
                </div>
                <div class="metrics">
                    <div class="metric">
                        <span class="metric-label">ì—­í• :</span>
                        <span class="metric-value">í•™ìŠµ/í‰ê°€/ê°œì„ </span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">í•™ìŠµ ì ìˆ˜:</span>
                        <span class="metric-value" id="evolution-score">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ê°œì„  ì œì•ˆ:</span>
                        <span class="metric-value" id="evolution-suggestions">-</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <h3>ğŸ“Š ì‹œìŠ¤í…œ í†µê³„</h3>
            <div class="metrics">
                <div class="metric">
                    <span class="metric-label">ì „ì²´ ìƒíƒœ:</span>
                    <span class="metric-value" id="overall-status">í™•ì¸ ì¤‘...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">í†µí•© ì ìˆ˜:</span>
                    <span class="metric-value" id="integrated-score">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ì²˜ë¦¬ëœ ëŒ€í™”:</span>
                    <span class="metric-value" id="total-conversations">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">í‰ê·  ì‘ë‹µ ì‹œê°„:</span>
                    <span class="metric-value" id="avg-response-time">-</span>
                </div>
            </div>
        </div>

        <div class="automation-section">
            <h3>ğŸ¤– ìë™í™” íŒŒì´í”„ë¼ì¸</h3>
            <div class="automation-controls">
                <button class="control-btn" onclick="startAutomation()">ìë™í™” ì‹œì‘</button>
                <button class="control-btn stop" onclick="stopAutomation()">ìë™í™” ì¤‘ì§€</button>
                <button class="control-btn" onclick="triggerAutomation()">ìˆ˜ë™ íŠ¸ë¦¬ê±°</button>
            </div>
            <div class="metrics">
                <div class="metric">
                    <span class="metric-label">ìë™í™” ìƒíƒœ:</span>
                    <span class="metric-value" id="automation-status">ì¤‘ì§€ë¨</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ì´ íŠ¸ë¦¬ê±° ìˆ˜:</span>
                    <span class="metric-value" id="total-triggers">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ì„±ê³µí•œ í•™ìŠµ ì‚¬ì´í´:</span>
                    <span class="metric-value" id="successful-cycles">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">í‰ê·  í•™ìŠµ ì ìˆ˜:</span>
                    <span class="metric-value" id="avg-learning-score">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ë§ˆì§€ë§‰ ì‹¤í–‰:</span>
                    <span class="metric-value" id="last-automation-run">-</span>
                </div>
            </div>
        </div>

        <div class="log-container">
            <h3>ğŸ“ ì‹œìŠ¤í…œ ë¡œê·¸</h3>
            <div id="log-entries">
                <div class="log-entry log-info">ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§ ì‹œì‘...</div>
            </div>
        </div>
    </div>

    <script>
        let logEntries = [];

        function addLogEntry(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = `<div class="log-entry log-${type}">[${timestamp}] ${message}</div>`;
            logEntries.unshift(entry);

            // ìµœëŒ€ 50ê°œ ë¡œê·¸ ìœ ì§€
            if (logEntries.length > 50) {
                logEntries = logEntries.slice(0, 50);
            }

            document.getElementById('log-entries').innerHTML = logEntries.join('');
        }

        function updateNodeStatus(nodeId, isHealthy, statusText) {
            const statusElement = document.getElementById(`${nodeId}-status`);
            const statusTextElement = document.getElementById(`${nodeId}-status-text`);

            if (isHealthy) {
                statusElement.className = 'status-indicator status-healthy';
                statusTextElement.textContent = 'ì •ìƒ';
            } else {
                statusElement.className = 'status-indicator status-unhealthy';
                statusTextElement.textContent = 'ì˜¤ë¥˜';
            }
        }

        async function checkNodeHealth(url, nodeName) {
            try {
                const response = await fetch(`${url}/health`);
                const data = await response.json();
                updateNodeStatus(nodeName.toLowerCase(), true, 'ì •ìƒ');
                addLogEntry(`${nodeName} ë…¸ë“œ ì •ìƒ ì‘ë™`, 'success');
                return data;
            } catch (error) {
                updateNodeStatus(nodeName.toLowerCase(), false, 'ì˜¤ë¥˜');
                addLogEntry(`${nodeName} ë…¸ë“œ ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'error');
                return null;
            }
        }

        async function testSystem() {
            try {
                const response = await fetch('http://localhost:8090/conversation/process', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_input: "ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§ í…ŒìŠ¤íŠ¸",
                        duri_response: "ë¶„ì‚° ì‹œìŠ¤í…œì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
                        metadata: { source: "dashboard", test: true }
                    })
                });

                const data = await response.json();

                if (data.status === 'success') {
                    document.getElementById('integrated-score').textContent = data.integrated_score.toFixed(3);
                    document.getElementById('overall-status').textContent = 'ì •ìƒ';
                    addLogEntry(`ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì„±ê³µ: ì ìˆ˜ ${data.integrated_score.toFixed(3)}`, 'success');
                } else {
                    addLogEntry('ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨', 'error');
                }

                return data;
            } catch (error) {
                addLogEntry(`ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message}`, 'error');
                return null;
            }
        }

        async function refreshData() {
            addLogEntry('ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹œì‘...', 'info');

            // ê° ë…¸ë“œ ìƒíƒœ í™•ì¸
            const coreData = await checkNodeHealth('http://localhost:8090', 'Core');
            const brainData = await checkNodeHealth('http://localhost:8091', 'Brain');
            const evolutionData = await checkNodeHealth('http://localhost:8092', 'Evolution');

            // ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
            const systemData = await testSystem();

            // í†µê³„ ì—…ë°ì´íŠ¸
            if (systemData) {
                document.getElementById('total-conversations').textContent = systemData.conversation_id || '-';
                document.getElementById('avg-response-time').textContent = `${(systemData.processing_time * 1000).toFixed(2)}ms`;
            }

            // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„
            document.getElementById('last-update').textContent = new Date().toLocaleString();

            addLogEntry('ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ', 'success');
        }

        // ìë™í™” íŒŒì´í”„ë¼ì¸ í•¨ìˆ˜ë“¤
        async function startAutomation() {
            try {
                const response = await fetch('http://localhost:8090/automation/start', {
                    method: 'POST'
                });
                const data = await response.json();

                if (data.status === 'success') {
                    document.getElementById('automation-status').textContent = 'ì‹¤í–‰ ì¤‘';
                    addLogEntry('ìë™í™” íŒŒì´í”„ë¼ì¸ ì‹œì‘ë¨', 'success');
                } else {
                    addLogEntry('ìë™í™” íŒŒì´í”„ë¼ì¸ ì‹œì‘ ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                addLogEntry(`ìë™í™” ì‹œì‘ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        async function stopAutomation() {
            try {
                const response = await fetch('http://localhost:8090/automation/stop', {
                    method: 'POST'
                });
                const data = await response.json();

                if (data.status === 'success') {
                    document.getElementById('automation-status').textContent = 'ì¤‘ì§€ë¨';
                    addLogEntry('ìë™í™” íŒŒì´í”„ë¼ì¸ ì¤‘ì§€ë¨', 'info');
                } else {
                    addLogEntry('ìë™í™” íŒŒì´í”„ë¼ì¸ ì¤‘ì§€ ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                addLogEntry(`ìë™í™” ì¤‘ì§€ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        async function triggerAutomation() {
            try {
                const response = await fetch('http://localhost:8090/automation/trigger', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_input: "ìˆ˜ë™ íŠ¸ë¦¬ê±° í…ŒìŠ¤íŠ¸",
                        duri_response: "ìë™í™” íŒŒì´í”„ë¼ì¸ í…ŒìŠ¤íŠ¸ ì‘ë‹µ",
                        metadata: { source: "dashboard", manual_trigger: true }
                    })
                });
                const data = await response.json();

                if (data.status === 'success') {
                    addLogEntry('ìˆ˜ë™ íŠ¸ë¦¬ê±° ì‹¤í–‰ë¨', 'success');
                } else {
                    addLogEntry('ìˆ˜ë™ íŠ¸ë¦¬ê±° ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                addLogEntry(`ìˆ˜ë™ íŠ¸ë¦¬ê±° ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        async function updateAutomationStats() {
            try {
                const response = await fetch('http://localhost:8090/automation/stats');
                const data = await response.json();

                if (data.status === 'success') {
                    const stats = data.automation_stats;
                    const learningStats = data.learning_stats;

                    document.getElementById('total-triggers').textContent = stats.total_triggers || 0;
                    document.getElementById('successful-cycles').textContent = stats.successful_learning_cycles || 0;
                    document.getElementById('avg-learning-score').textContent = (stats.average_learning_score || 0).toFixed(3);
                    document.getElementById('last-automation-run').textContent = stats.last_automation_run || '-';
                }
            } catch (error) {
                addLogEntry(`ìë™í™” í†µê³„ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // ì´ˆê¸° ë¡œë“œ
        refreshData();
        updateAutomationStats();

        // 30ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
        setInterval(refreshData, 30000);
        setInterval(updateAutomationStats, 30000);
    </script>
</body>
</html>
