# 현재 작업 상태 (2025-08-20 오후)

## 🚨 핵심 문제점 (No-Go)

### **retention.overrides 중복 키 (블로킹)**
- **위치**: `configs/storage_policy.yml` L101-109
- **문제**: `overrides:` 키가 연속 2회 선언됨
- **리스크**: `var/reports/**` 180일 보존이 무력화될 확률 ≥70%
- **상태**: 정책 파일 삭제됨 (되돌리기 완료)

### **로그 경로 혼재**
- **정책**: `var/logs/**` (복수)
- **기존**: `var/log/` (단수) + `var/logs/` (복수) 혼재
- **영향**: Git 추적/백업 시 잡음 5-10%

## ✅ 해결 방안 (설계 완료)

### **1. retention 병합**
- **방법**: overrides를 하나의 리스트로 병합
- **내용**:
  - `var/reports/**` → 180일
  - `var/state/backup_refs.json` → 30일
  - `var/state/restore_slo.jsonl` → 30일

### **2. 로그 표준화**
- **표준**: `var/logs/`로 통일
- **호환층**: `var/log -> var/logs` 심볼릭 링크 (WSL 환경에서 가능 확인됨)
- **적용**: 정책, .gitignore, 백업 exclude 모두 일치

### **3. 적용 타이밍**
- **시점**: HDD 이관 직전
- **방식**: 단일 커밋으로 모든 변경사항 적용

## 📋 진행 상황 체크리스트

- [x] **A) retention 블록 중복 키 확인** (완료)
- [x] **B) var/log 사용 스크립트 패턴 분석** (완료)
- [x] **C) 정책 병합 구체 방안 설계** (완료)
- [x] **심볼릭 링크 가능 여부 확인** (완료: 가능)
- [x] **현재 상태 기록** (완료)

## 🚀 다음 세션에서 진행할 작업

### **Phase 1: 정제된 정책 재작성**
- retention.overrides 단일 리스트로 병합
- 로그 표준화 (`var/logs/`로 통일)
- 호환층 설계 (`var/log -> var/logs` 심볼릭 링크)

### **Phase 2: 안정적인 검증 스크립트**
- awk 파싱 대신 grep 기반 단순 검증
- false negative 방지
- 참고용으로만 사용 (의사결정 근거로 사용 금지)

### **Phase 3: 실제 적용**
- HDD 이관 직전 단일 커밋
- .gitignore 정합
- backup_exclude.txt 생성

## 📊 리스크 평가 (현재 상태)

- **var/reports 보존 무력화**: ≥70% (블로킹) → **해결 후 0%**
- **로그 혼입/잡음**: 5-10% → **해결 후 0%**
- **precheck 오판**: 10-20% → **해결 후 0%**

## 💡 핵심 원칙

**"돌다리 두드리기" 전략 유지**
- 속도보다 정합성 우선
- 기존 시스템과 충돌 없이 진행
- 롤백 가능한 상태 유지

---
**작성일**: 2025-08-20 오후
**상태**: 설계 완료, 적용 대기
**다음 세션**: 정제된 정책 재작성 시작
