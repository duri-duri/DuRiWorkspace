
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DuRi 가족 상호작용</title>
    <style>
        body { font-family: 'Arial', sans-serif; margin: 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #333; margin-bottom: 10px; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-number { font-size: 2em; font-weight: bold; color: #667eea; }
        .questions-section { margin-bottom: 30px; }
        .question-card { background: #f8f9fa; padding: 20px; margin: 10px 0; border-radius: 10px; border-left: 5px solid #667eea; }
        .question-text { font-size: 1.1em; margin-bottom: 10px; }
        .question-meta { color: #666; font-size: 0.9em; }
        .btn { background: #667eea; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #5a6fd8; }
        .response-form { margin-top: 15px; padding: 15px; background: white; border-radius: 8px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .family-members { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .member-card { background: #e3f2fd; padding: 10px; border-radius: 8px; text-align: center; }
        .online { background: #c8e6c9; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏠 DuRi 가족 상호작용</h1>
            <p>가족과 함께하는 의미 있는 대화를 시작해보세요</p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="total-questions">0</div>
                <div>생성된 질문</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="response-rate">0%</div>
                <div>응답률</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avg-satisfaction">0</div>
                <div>평균 만족도</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="online-members">0</div>
                <div>온라인 가족</div>
            </div>
        </div>

        <div class="family-members">
            {% for member in family_members.values() %}
            <div class="member-card {% if member.is_online %}online{% endif %}">
                <div>{{ member.name }}</div>
                <div style="font-size: 0.8em;">{{ member.role }}</div>
            </div>
            {% endfor %}
        </div>

        <div style="text-align: center; margin-bottom: 30px;">
            <button class="btn" onclick="generateQuestions()">새 질문 생성</button>
        </div>

        <div class="questions-section">
            <h2>오늘의 질문들</h2>
            {% for question in questions %}
            <div class="question-card">
                <div class="question-text">{{ question.question_text }}</div>
                <div class="question-meta">
                    대상: {{ question.target_member }} |
                    유형: {{ question.question_type }} |
                    {% if question.is_answered %}
                    <span style="color: green;">✓ 답변 완료</span>
                    {% else %}
                    <span style="color: orange;">⏳ 답변 대기</span>
                    {% endif %}
                </div>
                <button class="btn" onclick="showResponseForm('{{ question.id }}')">답변하기</button>

                <div id="response-form-{{ question.id }}" class="response-form" style="display: none;">
                    <form onsubmit="submitResponse(event, '{{ question.id }}')">
                        <div class="form-group">
                            <label>답변자:</label>
                            <select name="responder_id" required>
                                {% for member in family_members.values() %}
                                <option value="{{ member.id }}">{{ member.name }} ({{ member.role }})</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>답변:</label>
                            <textarea name="response_text" rows="3" required placeholder="답변을 입력해주세요..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>감정 상태:</label>
                            <select name="emotional_tone">
                                <option value="positive">긍정적</option>
                                <option value="neutral">중립적</option>
                                <option value="negative">부정적</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>만족도 (1-10):</label>
                            <input type="number" name="satisfaction_score" min="1" max="10" value="8" required>
                        </div>
                        <button type="submit" class="btn">답변 제출</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <script>
        function generateQuestions() {
            fetch('/generate_questions', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({num_questions: 10})
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                }
            });
        }

        function showResponseForm(questionId) {
            const form = document.getElementById('response-form-' + questionId);
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }

        function submitResponse(event, questionId) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);

            const data = {
                question_id: questionId,
                responder_id: formData.get('responder_id'),
                response_text: formData.get('response_text'),
                emotional_tone: formData.get('emotional_tone'),
                satisfaction_score: formData.get('satisfaction_score')
            };

            fetch('/answer', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                }
            });
        }

        // 통계 업데이트
        function updateStats() {
            fetch('/api/stats')
            .then(response => response.json())
            .then(data => {
                document.getElementById('total-questions').textContent = data.total_questions_generated;
                document.getElementById('response-rate').textContent = data.response_rate.toFixed(1) + '%';
                document.getElementById('avg-satisfaction').textContent = data.average_satisfaction_score.toFixed(1);
                document.getElementById('online-members').textContent = data.online_family_members;
            });
        }

        // 페이지 로드 시 통계 업데이트
        updateStats();
        // 30초마다 통계 업데이트
        setInterval(updateStats, 30000);
    </script>
</body>
</html>
