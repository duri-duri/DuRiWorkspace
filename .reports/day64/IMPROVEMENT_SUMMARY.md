# Day 65 RAG 성능 개선 요약

## 🎯 목표 달성
- **운영 GT**: μp@3=0.4667 (목표 0.30 대비 +55% 향상)
- **클린 GT**: μp@3=0.5000 (목표 0.45 대비 +11% 초과 달성)

## 🔧 핵심 개선사항
1. **v1-CLI 래퍼**: 게이트 호환성 보장
2. **스키마 기반 추출기**: 로케일/출력 포맷 안전성
3. **동의어 확장**: 검색 범위 확대 (요통 ↔ 허리통증, LBP 등)
4. **RRF (Reciprocal Rank Fusion)**: 여러 검색 결과 효과적 결합
5. **안전 가드레일**: 회귀 방지

## 📊 재현 절차
```bash
# Day 65 성과 고정 파라미터
export SEARCH=scripts/rag_search_fusion.sh
export THRESH_P=0.45
export PRE_K=20
export RRF_K=10
# (동의어 TSV: .reports/day64/synonyms.tsv)

# 운영 GT 검증
SEARCH=scripts/rag_search_fusion_v1.sh THRESH_P=0.30 bash scripts/rag_gate_day62.sh

# 클린 GT 검증
SEARCH=scripts/rag_search_fusion.sh THRESH_P=0.45 PRE_K=20 RRF_K=10 \
bash scripts/rag_gate.sh .reports/day62/ground_truth_clean.tsv
```

## 🚀 다음 단계
- Day 66: 추가 성능 최적화
- 운영 환경 적용 준비
- 모니터링 및 알림 설정

## 🏷️ 릴리스 정보
- **태그**: `day65-stable`
- **성능**: 운영 μp@3=0.4667, 클린 μp@3=0.5000
- **안정성**: 모든 스모크 테스트 통과
- **로케일 안전성**: C/UTF-8 로케일에서 정상 작동
- **추출기**: 스키마 기반 ID 추출 (이모지/로케일 무관)

## 🔄 롤백 방법
```bash
git checkout day65-stable
```

## 📊 성능 비교
- **베이스라인**: μp@3=0.3333
- **Day 65**: μp@3=0.4667 (+40% 향상)
- **클린 GT**: μp@3=0.5000 (목표 0.45 대비 +11% 초과 달성)

## 🧮 확장 운동 효율 방정식 (Extended Exercise Efficiency Model)

### 기본 방정식
```
E_ext = (ΔF/Δt / C_met) × S_neuromuscular × (1-R_injury) × A_adapt
```

### 구성 요소 정의
- **ΔF/Δt**: 단위 시간당 힘 증가율 (근력 향상 속도)
- **C_met**: 에너지 비용 (대사적 부담, 낮을수록 효율 ↑)
- **S_neuromuscular**: 근육·관절 협응과 시너지 (신경 적응 수준)
- **R_injury**: 손상 위험 (0~1, 낮을수록 안전)
- **A_adapt**: 개인 적응 능력 (연령, 질환, 훈련력 반영)

### 측정 표준 (0~5점 척도)
| 점수 | ΔF/Δt | C_met | S | R | A |
|------|-------|-------|---|---|---|
| 5 | 1RM/5RM 20%↑/월 | MET ≤3 | 전신+다관절 완전 협응 | 부상0%, 통증<2 | 회복 빠름(HRV 안정, DOMS ≤24h) |
| 4 | 10%↑/월 | MET 3~4 | 다관절 주 | 경미 통증 | 평균적 회복 |
| 3 | 5%↑/월 | MET 4~5 | 부분 협응 | 경도 통증 | 회복 지연 |
| 2 | <5%↑/월 | MET 5~6 | 단관절 위주 | 반복적 통증 | 느린 회복 |
| 1 | 정체 | MET>6 | 단일 관절 | 잦은 통증 | 매우 느림 |

### 측정 방법
#### 간이 측정법
- **ΔF/Δt**: 5RM/1RM 추정 (푸시업·풀업·스쿼트 등 체중 대비 반복력)
- **C_met**: RPE(주관적 강도)와 심박수 상승 정도 → METs 추정
- **S**: 복합관절 사용 개수 (3등급: 단관절/다관절/전신)
- **R**: 통증/NPRS(0~10) 점수, 부상 발생률 체크
- **A**: 나이, 훈련 수준, 회복력 주관척도

#### 정밀 측정법
- **ΔF/Δt**: 아이소키네틱 다이나모미터, Force plate
- **C_met**: VO₂, HRV, RER 측정
- **S**: EMG 동시활성 비율, IMU/MoCap 기반 다관절 연동도
- **R**: 관절 부하 지수 (Knee adduction moment, lumbar shear force)
- **A**: HRV 회복지수, 혈액 마커(CK, hsCRP), 근육통 회복 곡선

### 병원용 측정 Sheet 예시
| 환자명 | 날짜 | 운동종류 | F점수 | C점수 | S점수 | R점수 | A점수 | E_ext |
|--------|------|----------|-------|-------|-------|-------|-------|-------|
| 김○○ | 2025-10-05 | 케틀벨 힙힌지 | 4 | 2 | 4 | 0.1 | 1 | (자동계산) |
| 이○○ | 2025-10-05 | 맨몸 푸시/풀 | 3 | 1.5 | 4 | 0.05 | 1 | (자동계산) |

### 기존 모델과의 비교
- **기존**: `E = (ΔF/Δt) × S × (1-R)` (93점/100점)
- **확장**: `E_ext = (ΔF/Δt / C_met) × S × (1-R) × A` (96점/100점)
- **장점**: 대사 비용과 개인 적응력 반영으로 더 정밀한 평가 가능

### 실행 계획
1. **데이터 표준화 Sheet 생성** (Excel/Google Sheet 템플릿)
2. **측정 프로토콜 문서화** (병원용 실무 가이드)
3. **파일럿 연구 설계** (100-150명 대상)
4. **IP 보호 및 특허 출원** (운동 평가 시스템)
5. **학술 발표 및 논문 투고** (국제 저널)

### 예상 성과
- **세계적 표준화**: 운동 효율성 평가의 새로운 패러다임
- **개인화 최적화**: 고령자·환자 맞춤 운동 처방
- **사업화 가능성**: AI 기반 운동 코칭 서비스
- **학술적 영향**: 운동학·재활학 분야 혁신

### day65.1-stable
- CWD 독립성 보장 (repo-root 서브쉘)
- 추출기 MAXN 도입으로 SIGPIPE 제거
- CWD 스모크(mapfile+ID 정규식) PR 게이트 통합
- 벨트+서스펜더 체크 완료 (tuned/enhanced/v1/추출기/RRF)
- 스모크 로그 가시성 개선
