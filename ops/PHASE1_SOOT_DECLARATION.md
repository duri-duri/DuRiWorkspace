# 🎯 Phase 1: SOoT 확정·정책 정렬 + 검증 2중 루프(기초)

> **생성일**: 2025-08-22
> **Phase 0 완료 확인**: ✅ 안전장치 가동 완료

## 🏛️ **SOoT (Single Source of Truth) 선언**

### **1) 진실원천 파일**
- **`configs/storage_policy.yml`**: Git 추적, 백업 포함/제외, 보존/삭제 금지 기준
- **`configs/retention.yml`**: 백업 보존 정책 및 프로필 정의

### **2) SOoT 원칙**
- **단일 진실원천**: 모든 백업 관련 정책은 이 두 파일에서만 정의
- **파생물 자동 생성**: `.gitignore`, `backup_exclude_*` 등은 자동 생성
- **검증 필수**: 파생물과 원천 정책의 일치성 검증

---

## 🔄 **정책 정렬 파이프라인**

### **1) 자동 생성 도구**
- **Git 추적**: `storage_policy.yml` → `.gitignore` 자동 생성
- **백업 제외**: `storage_policy.yml` → `backup_exclude.txt` 자동 생성
- **보존 정책**: `storage_policy.yml` → `retention.yml` 자동 생성

### **2) 검증 체계**
- **CI/CD**: PR에서 정책 일치성 자동 검증
- **로컬 검증**: 개발 중 정책 변경 시 즉시 검증
- **운영 검증**: 배포 후 정책 적용 상태 확인

---

## 🧪 **검증 2중 루프 기초**

### **1) 1차 검증: SHA256 체크섬**
- **목적**: 파일 무결성 보장
- **방법**: 모든 백업 파일에 대해 SHA256 해시 생성 및 검증
- **실행**: 백업 완료 후 자동 체크섬 검증

### **2) 2차 검증: 샘플 파일 열기**
- **목적**: 실제 파일 접근 가능성 및 내용 검증
- **방법**: 백업된 파일 중 랜덤 샘플 3개 선택하여 실제 열기
- **검증**: 파일 내용 읽기, 메타데이터 확인, 오류 없음 확인

---

## 📋 **Phase 1 실행 계획**

### **1단계: SOoT 확정 (Day 1)**
- [ ] `storage_policy.yml` 최종 검토 및 승인
- [ ] `retention.yml` 최종 검토 및 승인
- [ ] SOoT 선언 문서 작성 및 팀 공유

### **2단계: 정책 정렬 (Day 2-3)**
- [ ] 자동 생성 파이프라인 구축
- [ ] CI/CD 검증 체계 구축
- [ ] 로컬 검증 도구 구축

### **3단계: 검증 2중 루프 기초 (Day 4-5)**
- [ ] SHA256 체크섬 검증 시스템 구축
- [ ] 샘플 파일 열기 검증 시스템 구축
- [ ] 검증 결과 로깅 및 모니터링

---

## 🛠️ **구현 세부사항**

### **1) SHA256 체크섬 검증**
```bash
# 백업 완료 후 체크섬 검증
sha256sum -c backup_checksums.sha256
```

### **2) 샘플 파일 열기 검증**
```bash
# 랜덤 샘플 3개 선택 및 검증
find backup_dir -type f | shuf -n 3 | xargs -I {} file {}
```

### **3) 정책 일치성 검증**
```bash
# storage_policy.yml과 .gitignore 일치성 검증
python tools/policy_check_gitignore.py
```

---

## 📊 **성공 지표**

### **1) SOoT 정합성**
- **정책 일치율**: 100% (필수)
- **파생물 자동 생성**: 100% (필수)
- **검증 실패율**: 0% (필수)

### **2) 검증 2중 루프**
- **SHA256 검증 성공률**: 100% (필수)
- **샘플 파일 열기 성공률**: 100% (필수)
- **검증 소요 시간**: <30초 (목표)

---

## ✅ **Phase 1 완료 체크리스트**

- [ ] **SOoT 확정**: `storage_policy.yml` + `retention.yml` 최종 승인
- [ ] **정책 정렬**: 자동 생성/검증 파이프라인 구축 완료
- [ ] **검증 2중 루프**: SHA256 + 샘플 파일 열기 시스템 구축 완료
- [ ] **CI/CD 통합**: 정책 일치성 자동 검증 체계 구축 완료
- [ ] **문서화**: SOoT 선언 및 정책 정렬 가이드 완성

---

## 🚀 **다음 단계**

**Phase 2**: 스케줄·의존성 표준화 + 검증 2중 루프(강화)

> **⚠️ 주의**: Phase 1 완료 후에만 Phase 2 진행 가능
