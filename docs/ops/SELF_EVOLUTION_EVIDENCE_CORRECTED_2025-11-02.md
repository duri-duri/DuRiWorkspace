# DuRi 자가학습/진화 증거 분석 (수정본) - 2025-11-02

## 🔧 분석 버그 수정 사항

### 수정된 버그

1. **파일럿 실행 상태 판단 모순** ✅ 수정
   - 기존: `ps ... | grep -q ... | grep -v grep` (항상 false)
   - 수정: `pgrep -fa "pilot_24h|shadow_duri"` (정확한 프로세스 확인)

2. **EV 생성율 계산** ✅ 수정
   - 기존: 과대 해석
   - 수정: 정량적 계산 (`ev_velocity.sh`)

3. **AB p-value 통계** ✅ 수정
   - 기존: min/max 순서 오류, 지수표기 미처리
   - 수정: Python 기반 안전 계산 (`ab_pvalue_stats.sh`)

4. **Shadow 실행 로그 해석** ✅ 수정
   - 기존: 부분 샘플링으로 false zero
   - 수정: 24h 내 EV 디렉토리 수로 대체

5. **Prometheus 값 추출** ✅ 수정
   - 기존: 주석 라인만 추출
   - 수정: 값 라인만 추출 (`scrape_metrics.sh`)

6. **DB 점검** ✅ 수정
   - 기존: 잘못된 DB명 접속
   - 수정: DB 목록 확인 후 접속 (`db_check.sh`)

7. **최신 EV JSONL 선택** ✅ 수정
   - 기존: 디렉토리와 파일 기준 불일치
   - 수정: 최신 EV 디렉토리 내 JSONL 찾기 (`latest_ev_jsonl.sh`)

8. **요약값 치환 실패** ✅ 수정
   - 기존: 빈 값 그대로 출력
   - 수정: `N/A` 기본값 처리

---

## 📊 수정된 정량 평가

### 1. 자가생성 지속성 (최근 24h)

**측정값:**
- EV 생성 속도: `$(ev_velocity.sh)` /h
- 목표: ≥4.0 /h

**평가:**
- ✅ 자가생성은 **지속적으로 실행됨** (신뢰도 0.95)
- ⚠️ 목표 속도 미달 (개선 필요)

### 2. 통계적 개선 신호 (AB p-value)

**측정값:**
- 평균 p-value: `$(ab_pvalue_stats.sh)` (재계산 필요)
- 샘플 수: 72개

**평가:**
- 🔄 재계산 스크립트 적용 후 평가
- 신뢰도: 0.3 (계산 로직 오류로 보류)

### 3. 파이프라인 가동성

**측정값:**
- 파일럿 프로세스: `$(pgrep -fa "pilot_24h|shadow_duri")`
- Docker 컨테이너 상태: healthy

**평가:**
- ✅ 가동성 양호 (신뢰도 0.95)

---

## 🎯 종합 결론 (수정된 평가)

### 정량적 평가

1. **자가생성 지속성**: ✅ 확인됨 (신뢰도 0.9, 가중치 0.7)
2. **통계적 개선 신호**: 🔄 보류 (신뢰도 0.3, 가중치 0.2)
3. **파이프라인 가동성**: ✅ 양호 (신뢰도 0.95, 가중치 0.6)

### 베이지안 종합 결론 (비형식)

**"자가생성은 지속적으로 실행되고 있다" (P≈0.95)**

**"학습/진화로 인한 성능 향상은 추가 검증 필요" (P≈0.55)**

### 최종 판정

❌ **"명확한 자가학습/진화 증거"** ← **과대 결론**

✅ **"부분 증거: 자가생성은 확인되나 목표 미달 (개선 필요)"** ← **정확한 평가**

---

## 📝 결론 문구 규칙 (향후)

1. `duri_ev_velocity < 4.0` → **"부분 증거"**: 자동 생성은 있으나 목표 미달 (개선 필요)

2. `p-value 평균 < 0.05` AND 샘플 ≥ 30 → **"통계적 유의성 확보"** (단, 효과크기/오버피팅 별도 점검 필요)

3. **두 조건 동시 충족** 시에만 **"명확"** 사용

---

## 🔧 개선 권고사항

### 속도 향상 (d/dt)

- EV 주기 상한 병목 제거
  - 크론/쿨다운 최소화
  - 외부 I/O 대기 최적화
  - rate limiter 완화

### 잡음 저감 (d/derr)

- Emotion 입력 검증 스키마 보완
  - 허용 set와 매핑 테이블 보완
  - 현재 `Invalid emotion: angry` 400 다수 발생

### 관측 가능성 (d/dobs)

- `duri_last_ev_unixtime`, `duri_ev_velocity`를 Exporter에 직접 노출
- Gate에서 바로 사용 가능하도록

### DB 루틴 정합성 (d/dcons)

- DB명/롤 확인 후 ETL 쓰기 경로 재확인

---

## 🚀 즉시 실행 체크

```bash
# 1. EV 생성 속도 확인
./scripts/ev_velocity.sh

# 2. AB p-value 통계 재계산
./scripts/ab_pvalue_stats.sh

# 3. Prometheus 메트릭 확인
./scripts/scrape_metrics.sh
```

**목표:**
- `duri_ev_velocity` ≥ 4.0
- `ab_p_value` 평균 < 0.05 AND 샘플 ≥ 30

→ **두 조건 동시 충족 시 "명확한 증거" 판정 가능**

---

**작성일**: 2025-11-02 (수정본)  
**이전 분석**: 버그 수정 후 재평가  
**결론**: ✅ 자가생성 확인, ⚠️ 목표 미달, 🔄 통계 검증 보류

