# L4 도달 판단 기준 (L4 Readiness Criteria)

## 개요

이 문서는 L4 자동화 시스템의 도달/성취 판단 기준을 정의합니다. L4는 "완전 자동화" 또는 "좌동화(좌동화)"를 의미하며, 시스템이 인간의 개입 없이 안정적으로 작동하는 상태를 목표로 합니다.

## L4 도달 판단 기준

### 1. 필수 조건 (Must-Have)

다음 조건을 모두 만족해야 L4 도달로 판단됩니다:

#### 1.1 24시간 연속 안정성
- **기간**: 최소 24시간 연속
- **측정 지표**:
  - `l4_closed_loop_ok == 1` (24시간 연속)
  - `l4_weekly_decision_ts` 신선도 ≤ 120초 (연속)
  - 모든 핵심 메트릭이 정상 범위 내 유지

#### 1.2 핵심 지표 목표치 달성
- **Δ_effective ≤ 120s**: UTC 일관성 유지
- **l4_canon_bad_ratio < 0.02**: 정규화 손상률 < 2%
- **l4_backfill_last_rc == 0**: 백필 성공률 100%
- **l4_boot_status == 1**: 부팅 복구 성공

#### 1.3 자동화 루프 정상 작동
- `l4-weekly.timer` 활성화 및 정상 실행
- `l4-canonicalize.timer` 활성화 및 정상 실행
- `l4-backfill.timer` 활성화 및 정상 실행
- 모든 자동화 스크립트가 정상 종료 (exit code 0)

#### 1.4 카오스 테스트 통과
- `l4_chaos_test.sh` 실행 시 모든 테스트 통과
- 특히 A1 (산출물 삭제 후 백필), A4 (UTC 일관성) 필수 통과

### 2. 권장 조건 (Should-Have)

다음 조건을 만족하면 L4 안정성 평가가 향상됩니다:

#### 2.1 7일 연속 안정성
- **기간**: 최소 7일 연속
- **측정 지표**: 24시간 조건과 동일, 단 기간 확장

#### 2.2 자가복구 메커니즘 검증
- 산출물 삭제 후 자동 복구 (< 60초)
- 권한 오류 후 자동 복구
- 타이머 실패 후 자동 복구

#### 2.3 메트릭 품질
- `l4_canon_bad_ratio` < 0.01 (1% 미만)
- 메트릭 신선도 99% 이상 유지
- 알람 발생률 < 5% (거짓 양성 최소화)

### 3. 우수 조건 (Nice-to-Have)

다음 조건을 만족하면 L4+ 또는 L5 수준으로 평가됩니다:

#### 3.1 완전 무인 자동화
- PR 생성부터 머지까지 자동화
- 승인 자동화 (정책 기반)
- 자가치유 메커니즘 완성

#### 3.2 장기 안정성
- 30일 연속 안정성
- 계절성/주기성 변동 없음
- 리소스 사용량 안정적

## 6일 관찰 계획

### Day 1-2: 초기 안정화 (Initial Stabilization)

**목표**: 시스템이 정상 작동 상태로 진입하는지 확인

- 매 4시간마다 메트릭 확인
- 카오스 테스트 1회 실행
- 알람 발생 여부 확인

**합격 기준**:
- 모든 필수 지표가 목표치 내
- 카오스 테스트 통과
- 알람 발생 < 3회

### Day 3-4: 안정성 검증 (Stability Verification)

**목표**: 시스템이 지속적으로 안정적으로 작동하는지 확인

- 매 8시간마다 메트릭 확인
- 카오스 테스트 2회 실행 (오전/오후)
- 자가복구 메커니즘 검증

**합격 기준**:
- 모든 필수 지표가 목표치 내 유지
- 카오스 테스트 연속 통과
- 자가복구 테스트 성공

### Day 5-6: 최종 검증 (Final Verification)

**목표**: L4 도달 최종 확인

- 매 12시간마다 메트릭 확인
- 카오스 테스트 3회 실행
- 종합 평가 보고서 작성

**합격 기준**:
- 모든 필수 지표가 목표치 내 연속 유지
- 카오스 테스트 연속 통과
- 자가복구 메커니즘 검증 완료

## 일일 점검 체크리스트

### 매일 점검 항목

1. **메트릭 확인**:
   ```bash
   cat ~/.cache/node_exporter/textfile/l4_weekly_decision.prom
   cat ~/.cache/node_exporter/textfile/l4_canon_metrics.prom
   cat ~/.cache/node_exporter/textfile/l4_backfill_rc.prom
   ```

2. **타이머 상태 확인**:
   ```bash
   systemctl --user status l4-weekly.timer --no-pager -l
   systemctl --user status l4-canonicalize.timer --no-pager -l
   systemctl --user status l4-backfill.timer --no-pager -l
   ```

3. **카오스 테스트 실행** (선택):
   ```bash
   bash scripts/ops/l4_chaos_test.sh
   ```

4. **Prometheus 쿼리 확인**:
   ```
   (l4_canon_bad / clamp_min(l4_canon_total,1))
   (time() - l4_weekly_decision_ts)
   ```

### 주간 점검 항목

1. **종합 평가**:
   - 지난 7일간 메트릭 추이 분석
   - 알람 발생 패턴 분석
   - 자가복구 성공률 계산

2. **보고서 작성**:
   - 일일/주간 요약 보고서 생성
   - 목표치 달성률 계산
   - 개선 권장사항 제시

## L4 도달 판정 프로세스

### 단계 1: 데이터 수집 (6일)

- 매일 메트릭 확인 및 기록
- 카오스 테스트 결과 기록
- 알람 발생 기록

### 단계 2: 평가 (Day 6)

- 모든 필수 조건 충족 여부 확인
- 권장 조건 충족 여부 확인
- 우수 조건 충족 여부 확인

### 단계 3: 판정 (Day 6)

- **L4 도달**: 필수 조건 모두 충족
- **L4+ 도달**: 필수 + 권장 조건 모두 충족
- **L5 도달**: 필수 + 권장 + 우수 조건 모두 충족

### 단계 4: 선언 (Day 6)

- L4 도달 선언 및 문서화
- 태그 생성 및 릴리즈 노트 작성
- 다음 단계 계획 수립

## 위험 요소 및 대응

### 위험 요소

1. **메트릭 신선도 저하**: 스크립트 실행 실패 가능성
2. **타이머 실패**: systemd 타이머 비활성화 가능성
3. **권한 문제**: 파일 접근 권한 오류 가능성
4. **시스템 재부팅**: 자동 복구 실패 가능성

### 대응 방안

1. **자동 모니터링**: Prometheus 알람 규칙 설정
2. **자동 복구**: 실패 시 자동 재시도 메커니즘
3. **수동 점검**: 일일 점검 체크리스트 실행
4. **백업 계획**: 실패 시 롤백 절차 준비

## 확률 평가

### 현재 상태 (예상)

- **24시간 안정성**: p≈0.98
- **6일 연속 안정성**: p≈0.95
- **L4 도달**: p≈0.95 (6일 관찰 완료 시)

### 목표 상태

- **24시간 안정성**: p≥0.99
- **6일 연속 안정성**: p≥0.97
- **L4 도달**: p≥0.97

## 결론

L4 도달 판단은 **6일간의 관찰과 검증**을 통해 이루어집니다. 매일 정기적으로 메트릭을 확인하고, 카오스 테스트를 실행하며, 자가복구 메커니즘을 검증하여 시스템의 안정성을 확인합니다. 6일 관찰 완료 후 모든 필수 조건을 만족하면 L4 도달로 판정합니다.

