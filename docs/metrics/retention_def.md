# PoU 유지율 정의 (Day 37)

## 📊 **유지율 메트릭 정의**

### **기본 정의**
- **유저 기준**: 익명 `user_id` (고정)
- **Day0**: 첫 사용(or 노출) 시각
- **D+7 유지율**: `exists(event at [D+7±12h])`
- **집계 단위**: 코호트-일(YYYY-MM-DD, variant A/B)

### **상세 규칙**

#### **1. 유저 식별**
- `user_id`: 익명화된 고유 식별자
- 중복 제거: 동일 `user_id`는 하나의 레코드로 처리
- 결측값 처리: `user_id`가 없는 이벤트는 제외

#### **2. Day0 정의**
- **첫 사용**: 해당 유저의 첫 번째 이벤트 시각
- **노출 기준**: 첫 번째 노출 이벤트 시각 (옵션)
- **타임존**: UTC 고정
- **정밀도**: 일 단위 (YYYY-MM-DD)

#### **3. D+7 유지율 계산**
- **기간**: Day0 + 7일 ± 12시간
- **조건**: 해당 기간 내 최소 1개 이벤트 존재
- **결과**: 0 (미유지) 또는 1 (유지)
- **공식**: `retained_d7 = 1 if exists(event in [D0+7d-12h, D0+7d+12h]) else 0`

#### **4. 집계 단위**
- **코호트**: Day0 기준 YYYY-MM-DD
- **변형**: A/B 테스트 그룹
- **최종 단위**: (cohort_date, variant) 조합

### **입력 스키마**
```csv
timestamp,user_id,variant,event
2025-09-23T10:00:00Z,user_001,A,login
2025-09-23T10:05:00Z,user_001,A,action
2025-09-30T09:30:00Z,user_001,A,login
```

### **출력 스키마**
```csv
variant,retained_d7,cohort_date
A,1,2025-09-23
B,0,2025-09-23
A,1,2025-09-24
```

### **계산 예시**

#### **유저 A (유지됨)**
- Day0: 2025-09-23
- D+7 기간: 2025-09-30 00:00:00 ~ 2025-09-30 23:59:59
- 이벤트: 2025-09-30T09:30:00Z (기간 내)
- 결과: `retained_d7 = 1`

#### **유저 B (미유지)**
- Day0: 2025-09-23
- D+7 기간: 2025-09-30 00:00:00 ~ 2025-09-30 23:59:59
- 이벤트: 없음
- 결과: `retained_d7 = 0`

### **품질 검증**
- **최소 샘플 수**: 200 (그룹당)
- **결측값 비율**: < 1%
- **타임존 일관성**: UTC 고정
- **중복 제거**: `user_id` 기준

### **A/B 테스트 적용**
- **메트릭**: `retained_d7` (이진 지표)
- **검정 방법**: 2-표본 비율 검정
- **유의수준**: α = 0.05
- **최소 효과 크기**: 3%p 상승

### **게이트 규칙**
- **통계적 유의성**: `p < 0.05`
- **실질적 효과**: `mean_B - mean_A >= +0.03`
- **가드레일**: 안전성/지연 악화 없음
- **실패 시**: 승격 금지 + 개선안 도출

---

**문서 버전**: 1.0  
**생성 날짜**: 2025년 9월 30일  
**상태**: ✅ 정의 완료
